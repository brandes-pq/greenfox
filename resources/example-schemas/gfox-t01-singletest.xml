<?xml version="1.0" encoding="UTF-8"?>
<greenFox xmlns="http://www.greenfox.org/ns/schema" greenfoxURI="http://www.parsqube.de/ns/greenfox-schema/roli/t01-singletest">
    <context>
        <field name="case" value="*"/>
        <field name="baseUri"/>
        <field name="buildNumber"/>
        <field name="timestamp"/>        
    </context>
    <domain path="${baseUri}" label="main">
        <folder foxpath=".\\output\output.${case}">
            <targetSize msg="Output folder not found" count="1"/>

            <!-- Output files must be new -->
            <file foxpath="*">
                <lastModified msg="Stale output file" ge="${timestamp}"/>
            </file>

            <!-- Gibook and gi40 must not be too small -->
            <file foxpath="gibook.xml, gi40">
                <fileSize msg="Result file too small" ge="10000"/>
            </file>
            
            <!-- Output folder has summary with expected build number -->
            <file path="summary.xml">                
                <targetSize msg="Not exactly one summary." count="1"/>
                <xpath msg="Summary with unexpected buildnumber." expr="//buildNumber" eq="${buildNumber}"/>
            </file>

            <!-- In case of anchor errors, result must consist of summary.xml, anchor-errors.xml, checkreport.docx -->
            <folderSubset foxpath=".[summary.xml//returnCode eq 'ERROR_ANCHOR']" subsetLabel="withoutAnchorErrors"> 
                <!-- <targetSize msg="Not 2 tests with anchor errors" count="2"/> -->
                <folderContent msg="Return code ERROR_ANCHOR, but not the expected folder content."
                               files="summary.xml anchor-errors.xml checkreport.docx" quant="all" closed="false"/>
            </folderSubset>
            
            <!-- Unless anchor error occurs, result must include gibook and gi40 -->
            <folderSubset foxpath=".[summary.xml//returnCode ne 'ERROR_ANCHOR']" subsetLabel="withoutAnchorErrors"> 
                <!-- <targetSize msg="Not 13 tests without anchor errors" minCount="12"/> -->
                <folderContent msg="Return code not ERROR_ANCHOR, but not all files 'gibook.xml' and 'gi40.xml' found."
                               files="gibook.xml gi40.xml" quant="all"/>
            </folderSubset>
            
            <!-- folders with XSD errors -->
            <folderSubset foxpath=".[summary.xml//returnCode eq 'ERROR_XSD']" subsetLabel="withXsdErrors">
                <!-- <targetSize msg="Not exactly four tests with XSD errors" count="4"/> -->
                
                <!-- XSD errors file -->
                <file foxpath="xsd-errors.xml">
                   <targetSize msg="Missing result file xsd-errors.xml." count="1"/>
                    <xpath msg="XSD error without @puMsg attribute means a system error."
                           expr="//error[not(@puMsg)]" maxCount="0"/>
                </file>
            </folderSubset>
        </folder>
    </domain>
</greenFox>
