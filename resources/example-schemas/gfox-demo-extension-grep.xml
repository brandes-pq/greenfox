<?xml version="1.0" encoding="UTF-8"?>
<greenfox greenfoxURI="http://www.greenfox.org/ns/schema-examples/example-extension-grep"
          xmlns:ex="http://example.com"
          xmlns:xs="http://www.w3.org/2001/XMLSchema"
          xmlns="http://www.greenfox.org/ns/schema">

    <!-- *** External context *** -->
    <context>
        <field name="lastModified" value="2019-12-01"/>
    </context>    

    <constraintComponents>
        
        <constraintComponent constraintElementName="ex:grep">
            <param name="pattern" type="xs:string"></param>
            <param name="flags" type="xs:string?"></param>
            <validatorXPath>exists(unparsed-text-lines($this)[matches(., $pattern, $flags)])</validatorXPath>
        </constraintComponent>

        <constraintComponent constraintElementName="ex:grepYYY">
            <param name="pattern" type="xs:string"></param>
            <param name="flags" type="xs:string?"></param>
            <validatorXPath>
                exists($this ! unparsed-text-lines(.)[matches(., $pattern, $flags)])
            </validatorXPath>
        </constraintComponent>
        
        <constraintComponent constraintElementName="ex:grepXXX">
            <param name="plain"></param>
            <validatorXPath><![CDATA[
                    let $files := $this
                    return
                        some $file in $files satisfies
                        let $lines := unparsed-text-lines($file)
                        return
                            some $line in $lines satisfies
                                contains($line, $plain)
                ]]></validatorXPath>
        </constraintComponent>
        
    </constraintComponents>    
    
    <domain path="\projects\xsdbase\niem-4.2" 
            name="niem-4.2">    
        
        <!-- *** System root folder shape *** -->
        <folder foxpath="." id="systemRootFolderShape">
            <targetSize msg="No niem folder found" minCount="1"/>
            <file foxpath="README.md">
                <targetSize msg="README not found" minCount="1"/>    
                <ex:grep pattern="fbIx?" flags="i"
                         msg="File does not contain string '$pattern'."
                         msgOK="File contains string '$pattern'."/>                    
<!--                
                    <param name="pattern">fbIx?</param>
                    <param name="flags">i</param>
                </ex:grep>                    
-->                    

            </file>
        </folder>
    </domain>    
</greenfox>
