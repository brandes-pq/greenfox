<?xml version="1.0" encoding="UTF-8"?>
<greenFox xmlns="http://www.greenfox.org/ns/schema" greenfoxURI="http://www.greenfox.org/ns/schema-examples">
    <context>
        <field name="namespace" value="http://example.com/s1"/>
        <field name="lastModified" value="2019-11-01"/>
    </context>
    
    <domain path="\tt\greenfox\resources\example-system" label="system-abc">        
        <folder foxpath="system-abc"> 
            <targetSize count="1" 
                        msg="Expecting exactly one folder 'system-abc"/>
            <folder foxpath=".\\test-*[input][output][config]">
                <targetSize count="2"/>
                
                <folder foxpath="input[*.xml]" deactivated="true">
                    <file foxpath="*">
                        <targetSize minCount="1" 
                                    msg="Input folder must contain at least one msg"/>
                        <foxpath msg="For every input msg, there must be an output msg with corresponding root name"
                                 eq="true"
                                 expr="
let $expFileNameRS := file-name(.) ! replace(., 'RQ.xml$', 'RS.xml')                            
let $expRootNameRS := ./local-name(*) ! replace(., 'RQ$', 'RS')
let $actRootNameRS := ..\..\output\*[file-name(.) eq $expFileNameRS]/local-name(*)
return 
    $expRootNameRS = $actRootNameRS"                        
                        />          
                    </file>
                </folder>
                
                <folder foxpath="input[*.json]" deactivated="true">
                    <file foxpath="*" mediatype="json">
                        <targetSize minCount="1" 
                            msg="Input folder must contain at least one msg"/>
                        <xpath expr="/json/*/local-name(.)" matches="RQ" deactivated="true"/>
                        <foxpath expr="$jdoc/json/*/local-name(.)" matches="RQ" deactivated="true"/>
                        
                        <foxpath msg="For every input msg, there must be an output msg with corresponding root name"
                            eq="true"
                            expr="
let $expFileNameRS := file-name(.) ! replace(., 'RQ.json$', 'RS.json')                            
let $expRootNameRS := $jdoc/*/local-name(*) ! replace(., 'RQ$', 'RS')
let $actRootNameRS := ..\..\output\*[file-name(.) eq $expFileNameRS]\json-doc(.)/*/local-name(*)
return 
    $expRootNameRS = $actRootNameRS"                        
                        />          
                        
                    </file>
                </folder>
                
                <folder foxpath="output[*.xml]" deactivated="true">
                    <file foxpath="*">
                        <lastModified ge="${lastModified}"
                            msg="Output files must be newly written."/>
                        <xpath expr="//*:returnCode" matches="OK|NOTFOUND"
                            msg="Return code should be OK or NOTFOUND"/>
                    </file>
                </folder>

                <folder foxpath="output[*.json]" deactivated="false">
                    <file foxpath="*" mediatype="json">
                        <lastModified ge="${lastModified}"
                            msg="Output files must be newly written."/>
                        <xpath expr="//*:returnCode" matches="^(OK|NOTFOUND)$"
                            msg="Return code should be OK or NOTFOUND"/>
                    </file>
                </folder>
                
            </folder>
        </folder>
    </domain>
    
</greenFox>
