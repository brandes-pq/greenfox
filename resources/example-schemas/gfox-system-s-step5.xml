<?xml version="1.0" encoding="UTF-8"?>
<greenfox greenfoxURI="http://www.parsqube.de/ns/greenfox-schema/examples/system-s"
          xmlns="http://www.greenfox.org/ns/schema">
    
    <domain path="\tt\greenfox\resources\example-system\system-s" 
            label="system-s">    
        
        <!-- *** Root folder containing the test system *** -->
        <folder foxpath=".">
            
            <!-- *** XSD folder -->
            <folder foxpath=".\\resources\xsd">
                <targetSize msg="No XSD folder found" count="1"/>
                <file foxpath="*.xsd">
                    <targetSize msg="No XSDs found" minCount="1"/>
                </file>
            </folder>                

            <!-- *** Codelist folder -->
            <folder foxpath=".\\resources\codelists">
                <targetSize msg="No codelist folder found" count="1"/>
                <file foxpath="*">
                    <targetSize msg="No codelist files found" minCount="1"/>
                </file>
            </folder>                
            
            <!-- *** Test case folders *** -->
            <folder foxpath=".\\test-*[input][output][config]">
                <targetSize msg="No testcase folders found" minCount="1"/>
                <folderContent msg="Testcase contains member other than input, output, config, log-*." 
                               closed="true">
                    <memberFolders names="input, output, config"/>
                    <memberFile name="log-" occ="*"/>
                </folderContent>

                <!-- *** msg config -->
                <file foxpath="config\msg-config.csv" mediatype="csv" csv.separator="," csv.withHeader="yes">
                    <targetSize msg="Config file missing" count="1"/>
                    
                    <!-- Check - configured return codes ok? -->
                    <xpath msg="Config file contains unknown return code" expr="//returnCode">
                        <in>
                            <eq>OK</eq>
                            <eq>NOFIND</eq>
                            <like>ERROR_*</like>
                        </in>                                
                    </xpath>                    
                </file>
                
                <!-- *** Request message *** -->
                <file foxpath="input\*">
                    <targetSize msg="Input folder without request msgs" minCount="1"/>
                    
                    <!-- Check - request with response ? -->
                    <foxpath msg="Request without response" count="1" expr="
                        let $expFileNameRS := file-name(.) ! replace(., '(.*)RQ(.*)\.(xml|json)$', '$1RS$2.$3')    
                        return ..\..\output\*[file-name(.) eq $expFileNameRS]" />
                </file>
                
            </folder>
        </folder>
    </domain>    
</greenfox>
