<?xml version="1.0" encoding="UTF-8"?>
<greenfox greenfoxURI="http://www.greenfox.org/ns/schema-examples/example-folder-content"
    xmlns="http://www.greenfox.org/ns/schema"
    xmlns:ex="http://example.com/ns">
    
    <!-- *** External context *** -->
    <context>
        <field name="domain" value="\tt\greenfox\resources\example-schemas"/>
        <field name="gfox" value="gfox-system-s.xml"/>
    </context>    

    <!-- *** Constraint component *** -->
    <constraintComponents>
        <constraintComponent constraintElementName="ex:allowedAtts">
            <param name="attNames"></param>
            <xpathExpr><![CDATA[
@*/local-name(.)[not(. = tokenize($attNames))]
            ]]></xpathExpr>
        </constraintComponent>
        <constraintComponent constraintElementName="ex:mandatoryAtts">
            <param name="attNames"></param>
            <xpathExpr><![CDATA[
let $atts := @*/local-name(.) return tokenize($attNames)[not(. = $atts)]
            ]]></xpathExpr>
        </constraintComponent>
        
    </constraintComponents>
    
    
    <domain path="${domain}" 
        name="schema-schemas">    
        
        
        <!-- *** System root folder shape *** -->
        <folder foxpath="." id="schemasFolderShape">
            <targetSize msg="No schemas folder found" minCount="1"/>
            <file foxpath="${gfox}">
                <targetSize msg="system-s schema not found" minCount="1"/>

                <!-- check generic attributes 
                     ======================== -->
                <!-- check @id -->
                <focusNode xpath="//*[@id]">
                    <xpath description="Validates the @id attributes "
                        expr="@id"
                        datatype="NCName"
                        datatypeMsg="Invalid @id - value must be an NCName"
                        datatypeMsgOK="OK - @id attributes: no values which are not NCNames"
                        deactivated="false"/>
                </focusNode>
                
                <!-- check <greenfox>
                     ================ -->                
                <xpath description="Validates top-level elements"
                    expr="*:greenfox/*/local-name(.)"
                    inMsg="Unexpected top-level element; expected names: context, constraintComponents, domain, folder, file"
                    inMsgOK="OK - top-level element names"
                    deactivated="false">
                    <in>
                        <eq>context</eq>
                        <eq>constraintComponents</eq>
                        <eq>domain</eq>
                        <eq>folder</eq>
                        <eq>file</eq>
                    </in>                    
                </xpath>                

                <!-- check <context>
                     =============== -->                
                <!-- check attribute names -->
                <xpath description="Validates the absence of attributes in top-level element 'context'"
                    expr="*:greenfox/*:context/@*"
                    maxCount="0"
                    maxCountMsg="Unexpected attributes in 'context' element - no attributes allowed"
                    maxCountMsgOK="OK - 'context' element: no attributes"
                    deactivated="false"/>
                
                <!-- check child element names -->
                <xpath description="Validates element names in top-level element 'context'"
                    expr="*:greenfox/*:context/*/local-name(.)"
                    eq="field"
                    eqMsg="Unexpected child element in 'context' element; only 'field' children allowed"
                    eqMsgOK="OK - 'context' element: no unexpected child element names"
                    deactivated="false"/>
                
                <!-- check <field>
                     ============= -->   
                <focusNode xpath="*:greenfox/*:context/*:field">
                    <!-- check attribute names and mandatory attributs -->

                    <ex:allowedAtts
                        msg="Unexpected attributes in 'field' element; expected: name, value"
                        msgOK="OK - 'field' element: no unexpected attributes">
                        <param name="attNames">name value</param>
                    </ex:allowedAtts>
                    
                    <xpath description="Validates the attribute names in 'field' elements"
                        expr="@*/local-name(.)"
                        inMsg="Unexpected attributes in 'field' element; expected names: name, value"
                        inMsgOK="OK - 'field' element: no unexpected attribute names"
                        containsMsg="Missing mandatory attribute 'name'"
                        containsMsgOK="OK - 'field' element has mandatory 'name' attribute"
                        deactivated="false">
                        <in>
                            <eq>name</eq>   
                            <eq>value</eq>
                        </in>
                        <contains>name</contains>                        
                    </xpath>
                
                    <!-- check @name: type must be NCName -->
                    <xpath description="Validates the @name attribute in 'field' elements"
                        expr="@name"
                        datatype="NCName"
                        datatypeMsg="Unexpected datatype of @name in 'field' element; expected type is 'NCName'"
                        datatypeMsgOK="OK - 'field' element: no @name with type ne NCName"
                        deactivated="false"/>                
                </focusNode>
                
                <!-- check <constraintComponents>
                     ============================ -->                
                <xpath description="Validates content of top-level element 'constraintComponents'"
                    expr="*:greenfox/*:constraintComponents/*/local-name(.)"
                    eq="constraintComponent"
                    eqMsg="Unexpected child element in 'constraintComponents' element; only 'constraintComponent' children allowed"
                    eqMsgOK="OK - 'constraintComponents element: child element names"
                    deactivated="false"/>                

                <!-- check <domain>
                     ============== -->                
                <focusNode xpath="*:greenfox/*:domain">
                    <!-- check attribute names, mandatory atts -->    
                    <ex:allowedAtts
                        msg="Unexpected attributes in 'domain' element; expected: path, name"
                        msgOK="OK - 'domain' element: no unexpected attributes">
                        <param name="attNames">path name</param>
                    </ex:allowedAtts>
                    <ex:mandatoryAtts
                        msg="Missing mandatory attributes in 'domain' element; expected: path, name"
                        msgOK="OK - 'domain' element: with mandatory attributes ('path' and 'name')">
                        <param name="attNames">path name</param>
                    </ex:mandatoryAtts>
                    <!--
                    <xpath description="Validates the attribute names in 'domain' elements"
                        expr="@*/local-name(.)"
                        inMsg="Unexpected attributes in 'domain' element; expected attribute names: path, name"
                        inMsgOK="OK - 'domain' element: no unexpected attributes"
                        containsMsg="Missing mandatory attribute(s)"
                        containsMsgOK="OK - 'domain' element: with mandatory attributes ('path' and 'name')"
                        deactivated="false">
                        <in>
                            <eq>path</eq>
                            <eq>name</eq>
                        </in>
                        <contains>path</contains>                        
                        <contains>name</contains>
                    </xpath>
                    -->
                    <xpath description="Validates the @path value"
                        expr="@path"
                        matches="\\"
                        matchesMsg="Path value must use backslashes"
                        matchesMsgOK="OK - 'domain' element: @path uses backslashes"
                        notMatches="/"
                        notMatchesMsg="Path value must not use slashes, only backslashes"
                        notMatchesMsgOK="OK - 'domain' element: @path does not contain slashes"
                        deactivated="false">
                    </xpath>
                </focusNode>
                
                <!-- check <folder>
                     ============== -->     
                <!-- <folder> - check attribute names -->
                <xpath description="Validates the attribute names in 'folder' elements"
                    expr="*:greenfox//*:folder/@*/name()"
                    inMsg="Unexpected attribute on 'folder' element; expected names: foxpath, id"
                    inMsgOK="OK - 'folder' element: attribute names"
                    deactivated="false">
                    <in>
                        <eq>foxpath</eq>
                        <eq>id</eq>
                    </in>
                </xpath>               

                <!-- <folder> - check child element names -->
                <xpath description="Validates content of 'folder' elements"
                    expr="*:greenfox//*:folder/*/local-name(.)"
                    inMsg="Unexpected child element in 'folder' element; expected names: targetSize, file, folder, folderContent, foxpath"
                    inMsgOK="OK - 'folder' element: child element names"
                    deactivated="false">
                    <in>
                        <eq>targetSize</eq>
                        <eq>file</eq>
                        <eq>folder</eq>
                        <eq>folderContent</eq>
                        <eq>foxpath</eq>
                    </in>
                </xpath>

                <!-- <folder> (under domain) - check mandatory attribute names -->
                <xpath description="Validates 'folder' elements, presence of mandatory attributes"
                    expr="*:greenfox/*:domain//*:folder"
                    deactivated="false">
                    
                    <xpath description="Validates an individual 'folder' element, presence of mandatory attributes"
                        expr="@*/local-name(.)"
                        quant="some"
                        containsMsg="Missing mandatory attribute (one of 'foxpath', 'path')"
                        containsMsgOK="OK - 'folder' element has mandatory attributes (one of 'foxpath', 'path')"
                        deactivated="false">
                        <contains>foxpath</contains>                        
                        <contains>path</contains>
                    </xpath>
                    
                </xpath>                
                
                <!-- check <targetSize>
                     ================== -->                
                <!-- <targetSize> - check attribute names -->
                <xpath description="Validates attribute names at 'targetSize' elements"
                    expr="*:greenfox//*:targetSize/@*/name()"
                    inMsg="Unexpected attribute on 'targetSizefolder' element; 
                           expected names: id, count, minCount, maxCount, msg, msgOK, minCountMsg, minCountMsgOK, maxCountMsg, maxCountMsgOK"
                    inMsgOK="OK - 'targetSize' element: no unexpected attribute names"
                    deactivated="false">
                    <in>
                        <eq>id</eq>
                        <eq>count</eq>
                        <eq>minCount</eq>
                        <eq>maxCount</eq>
                        <eq>msg</eq>
                        <eq>msgOK</eq>
                        <eq>minCountMsg</eq>
                        <eq>minCountMsgOK</eq>
                        <eq>maxCountMsg</eq>
                        <eq>maxCountMsgOK</eq>                        
                    </in>
                </xpath>

                <!-- <targetSize> - check mandatory attributes -->
                <xpath description="Validates 'targetSize' elements, presence of mandatory attributes"
                    expr="*:greenfox//*:targetSize">
                    
                    <xpath expr="@*/local-name(.)"
                        quant="some"                        
                        containsMsg="Validates an individual 'targetSize' elements, must contains at least one attribute from 'minCount', 'maxCount', 'count'"
                        containsMsgOK="OK - 'targetSize' has at least one attribute from 'minCount', 'maxCount', 'count'">
                        <contains>minCount</contains>                                                    
                        <contains>maxCount</contains>
                        <contains>count</contains>
                    </xpath>
                </xpath>
                
                
                <!-- <targetSize> - check attribute values -->
                <xpath description="Check attribute values, 'minCount'"
                    expr="*:greenfox//*:targetSize/@minCount"
                    datatype="integer"
                    datatypeMsg="Element 'targetSize', attributes 'minCount' must have integer values"
                    datatypeMsgOK="OK - 'targetSize' element: no @minCount atts with non-integer type"
                    ge="0"
                    geMsg="Element 'targetSize', attributes 'minCount' must be ge 0"
                    geMsgOK="OK - 'targetSize' element: no @minCount atts lt 0"/>
                 />
                <xpath description="Check attribute values, 'maxCount, count"
                    expr="*:greenfox//*:targetSize/(@maxCount, @count)"
                    matches="^\d+|\*$"
                    matchesMsg="Element 'targetSize', attributes 'maxCount' and 'count' must have integer values or be '*'"
                    matchesMsgOK="OK - 'targetSize' element: no @maxCount or @count atts with non-integer values ne '*'"
                />
                
                <!-- <targetSize> - check empty content -->
                <xpath description="Validates content of 'targetSize' elements"
                    expr="*:greenfox//*:targetSize/*"
                    maxCount="0"
                    maxCountMsg="Unexpected child element found in 'targetSize' element - 'targetSize' must be empty"
                    maxCountMsgOK="OK - 'targetSize' element: empty"
                    deactivated="false"/>

                <!-- check <folderContent>
                     ===================== -->                
                <!-- <folderContent> - check attribute names -->
                <xpath description="Validates attribute names at 'folderContent' elements"
                    expr="*:greenfox//*:folderContent/@*/name()"
                    inMsg="Unexpected attribute on 'folderContent' element; expected names: id, closed"
                    inMsgOK="OK - 'folderContent' element: no unexpected attribute names"
                    deactivated="false">
                    <in>
                        <eq>id</eq>
                        <eq>closed</eq>
                        <eq>closedMsg</eq>
                        <eq>closedMsgOK</eq>
                    </in>
                </xpath>
                
                <!-- check <file>
                     ============ -->     
                <!-- <file> - check attribute names -->
                <xpath description="Validates the attribute names in 'file' elements"
                    expr="*:greenfox//*:file/@*/name()"
                    inMsg="Unexpected attribute in 'file' element; expected names: foxpath, id"
                    inMsgOK="OK - 'file' element: no unexpected attribute names"
                    deactivated="false">
                    <in>
                        <eq>foxpath</eq>
                        <eq>id</eq>
                        <eq>mediatype</eq>
                        <eq>csv.separator</eq>
                        <eq>csv.withHeader</eq>
                    </in>
                </xpath>               
                
                
                
            </file>
        </folder>
    </domain>    
</greenfox>

